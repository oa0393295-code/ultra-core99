<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ù„ØªØ±Ø§ ÙƒÙˆØ± V15 | Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=JetBrains+Mono:wght@500;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --sys-cyan: #06b6d4;
            --sys-emerald: #10b981;
            --sys-bg: #010409;
            --sys-card: rgba(13, 17, 23, 0.95);
            --sys-border: rgba(48, 54, 61, 0.8);
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--sys-bg);
            color: #e6edf3;
            background-image: radial-gradient(circle at 2px 2px, rgba(6, 182, 212, 0.05) 1px, transparent 0);
            background-size: 40px 40px;
            margin: 0;
        }

        .font-mono { font-family: 'JetBrains Mono', monospace; }

        .ultra-glass {
            background: var(--sys-card);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--sys-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
            transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        .timer-viewport {
            position: relative;
            width: 440px;
            height: 440px;
            filter: drop-shadow(0 0 20px rgba(6, 182, 212, 0.2));
        }

        .svg-ring { transform: rotate(-90deg); width: 100%; height: 100%; }
        .ring-track { fill: none; stroke: #161b22; stroke-width: 18; }
        .ring-progress {
            fill: none; stroke: var(--sys-cyan); stroke-width: 18; stroke-linecap: round;
            stroke-dasharray: 880; stroke-dashoffset: 880;
            transition: stroke-dashoffset 1s linear;
        }

        .btn-command {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: #000;
            font-weight: 900;
            letter-spacing: -0.5px;
            box-shadow: 0 4px 14px 0 rgba(6, 182, 212, 0.39);
            transition: 0.3s;
        }

        .btn-command:active { transform: scale(0.95); }

        .log-item {
            border-right: 5px solid var(--sys-cyan);
            background: linear-gradient(90deg, rgba(30, 41, 59, 0.4) 0%, transparent 100%);
        }

        .status-badge {
            font-size: 9px;
            padding: 2px 10px;
            border-radius: 20px;
            background: rgba(16, 185, 129, 0.1);
            color: var(--sys-emerald);
            border: 1px solid rgba(16, 185, 129, 0.2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #30363d; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--sys-cyan); }
        
        /* Modal Style for Editing */
        #edit-modal { background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="antialiased overflow-x-hidden">

    <div id="gatekeeper" class="fixed inset-0 z-[10000] bg-black flex flex-col items-center justify-center p-6">
        <div class="relative mb-12 text-center">
            <div class="absolute -inset-20 bg-cyan-500/10 blur-[120px] rounded-full"></div>
            <h1 class="text-9xl font-black text-white italic tracking-tighter">UC<span class="text-cyan-500">.</span></h1>
            <p class="text-slate-500 font-mono tracking-[0.5em] mt-4">V15 ULTIMATE BUILD</p>
        </div>
        <button id="gate-trigger" class="btn-command px-24 py-7 rounded-[2rem] text-2xl tracking-tighter">ØªÙ‡ÙŠØ¦Ù€Ù€Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù€Ù…Ø±ÙƒØ²ÙŠ</button>
    </div>

    <div id="app-container" class="hidden opacity-0 transition-opacity duration-1000">
        <header class="ultra-glass sticky top-0 z-[500] px-10 py-6 flex justify-between items-center border-b border-white/5">
            <div class="flex items-center gap-8">
                <div class="h-14 w-2 bg-cyan-500 rounded-full shadow-[0_0_15px_rgba(6,182,212,0.5)]"></div>
                <div>
                    <h2 class="text-3xl font-black text-white leading-none">Ù…Ù€Ø±ÙƒØ² Ø§Ù„Ù€ØªØ­ÙƒÙ…</h2>
                    <p id="active-user-tag" class="text-[10px] text-cyan-500 font-bold uppercase tracking-[0.3em] mt-2"></p>
                </div>
            </div>
            <div class="flex items-center gap-6">
                <div id="live-indicator" class="flex items-center gap-2 px-4 py-2 bg-emerald-500/5 rounded-full border border-emerald-500/20">
                    <div class="w-2 h-2 bg-emerald-500 rounded-full animate-ping"></div>
                    <span class="text-[10px] font-black text-emerald-500">Ø§ØªØµØ§Ù„ Ù†Ø´Ø·</span>
                </div>
                <button id="system-exit" class="text-red-500 font-black text-xs hover:underline">Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…</button>
            </div>
        </header>

        <main class="max-w-[1920px] mx-auto p-10 grid grid-cols-12 gap-12">
            
            <section class="col-span-12 lg:col-span-3 space-y-10">
                <div class="ultra-glass rounded-[3.5rem] p-10 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-emerald-500"></div>
                    <h3 class="text-2xl font-black text-white mb-10 flex items-center justify-between">
                        Ø§Ù„ÙˆØ±Ø¯ Ø§Ù„Ø±ÙˆØ­Ø§Ù†ÙŠ
                        <span id="prayer-count-ui" class="text-sm font-mono text-emerald-500 bg-emerald-500/10 px-3 py-1 rounded-lg">0/6</span>
                    </h3>
                    <div id="prayer-container" class="space-y-4"></div>
                    
                    <div class="mt-12 space-y-6">
                        <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest text-center">ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù†</p>
                        <div class="flex gap-4">
                            <input type="number" id="quran-input" class="w-full bg-slate-900/50 border border-slate-700 rounded-2xl px-6 py-5 text-white font-black text-2xl outline-none focus:border-emerald-500" placeholder="0">
                            <button onclick="executeQuranUpdate()" class="bg-emerald-500 text-black px-8 rounded-2xl font-black hover:bg-white transition-all">Ø­ÙØ¸</button>
                        </div>
                    </div>
                </div>
            </section>

            <section class="col-span-12 lg:col-span-6 space-y-10">
                <div class="ultra-glass rounded-[5rem] p-20 flex flex-col items-center justify-center relative">
                    <div class="timer-viewport">
                        <svg class="svg-ring" viewBox="0 0 320 320">
                            <circle class="ring-track" cx="160" cy="160" r="140"></circle>
                            <circle id="timer-progress-bar" class="ring-progress" cx="160" cy="160" r="140"></circle>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <h2 id="timer-display" class="text-8xl font-mono font-black text-white tracking-tighter">00:00:00</h2>
                            <div id="engine-mode" class="mt-6 px-8 py-2 bg-cyan-500/10 border border-cyan-500/20 rounded-full text-[10px] font-black text-cyan-400 uppercase tracking-widest">System Standby</div>
                        </div>
                    </div>
                    
                    <button id="timer-trigger" class="btn-command mt-16 w-full max-w-lg py-10 rounded-[3rem] text-4xl italic tracking-tighter">ØªÙØ¹ÙŠÙ„ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ØªØ±ÙƒÙŠØ²</button>
                    
                    <div class="grid grid-cols-2 gap-8 w-full mt-16 pt-10 border-t border-white/5">
                        <div class="text-center">
                            <p class="text-[10px] text-slate-500 font-black uppercase mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØµÙØ­Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                            <p id="today-quran-stat" class="text-3xl font-black text-white font-mono">0</p>
                        </div>
                        <div class="text-center">
                            <p class="text-[10px] text-slate-500 font-black uppercase mb-2">Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©</p>
                            <p id="today-mins-stat" class="text-3xl font-black text-white font-mono">0</p>
                        </div>
                    </div>
                </div>

                <div class="ultra-glass rounded-[3.5rem] p-12">
                    <h3 class="text-2xl font-black text-white mb-10 flex items-center gap-4">
                        <div class="w-2 h-8 bg-cyan-500"></div>
                        Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø®Ø§Øµ Ø¨ÙŠ
                    </h3>
                    <div id="my-logs-archive" class="space-y-6 max-h-[600px] overflow-y-auto pr-6"></div>
                </div>
            </section>

            <section class="col-span-12 lg:col-span-3 space-y-10">
                <div class="ultra-glass rounded-[3rem] p-8 border-b-4 border-cyan-500">
                    <h3 class="text-xl font-black text-center text-white mb-10 tracking-widest">Ù„ÙˆØ­Ø© Ø§Ù„Ù†Ø®Ø¨Ø© ğŸ†</h3>
                    <div id="global-leaderboard" class="space-y-4"></div>
                </div>

                <div class="ultra-glass rounded-[3rem] h-[550px] flex flex-col overflow-hidden">
                    <div class="p-6 bg-slate-900/50 border-b border-slate-800 text-center">
                        <span class="text-[10px] font-black text-cyan-500 tracking-[0.4em]">ENCRYPTED CHAT</span>
                    </div>
                    <div id="chat-messages" class="flex-1 overflow-y-auto p-8 space-y-6"></div>
                    <div class="p-6 bg-slate-950 flex gap-4">
                        <input id="chat-input-field" type="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." class="flex-1 bg-slate-900 border-none rounded-2xl px-6 py-4 text-sm text-white outline-none ring-1 ring-slate-800 focus:ring-cyan-500">
                        <button id="send-chat-btn" class="bg-cyan-500 text-black px-8 rounded-2xl font-black text-xs">Ø¥Ø±Ø³Ø§Ù„</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="edit-modal" class="hidden fixed inset-0 z-[10001] flex items-center justify-center p-6">
        <div class="ultra-glass p-12 rounded-[3rem] w-full max-w-lg">
            <h4 id="edit-date-title" class="text-3xl font-black text-white mb-8 italic">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h4>
            <div class="space-y-8">
                <div>
                    <label class="text-[10px] text-slate-500 font-black uppercase tracking-widest mb-4 block">Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚</label>
                    <input type="number" id="edit-mins-input" class="w-full bg-slate-900/80 border border-slate-700 rounded-2xl px-6 py-4 text-white font-black text-xl">
                </div>
                <div>
                    <label class="text-[10px] text-slate-500 font-black uppercase tracking-widest mb-4 block">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª</label>
                    <input type="number" id="edit-quran-input" class="w-full bg-slate-900/80 border border-slate-700 rounded-2xl px-6 py-4 text-white font-black text-xl">
                </div>
                <div class="flex gap-4 pt-4">
                    <button id="save-edit-btn" class="flex-1 bg-cyan-500 text-black font-black py-4 rounded-2xl hover:bg-white transition-all">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                    <button onclick="closeEditModal()" class="flex-1 bg-slate-800 text-white font-black py-4 rounded-2xl">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, query, collection, orderBy, limit, updateDoc, increment, addDoc, serverTimestamp, getDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyASLT_wouo9BTjd-dH18x8CLbqBZSMbz04",
            authDomain: "ultra-core.firebaseapp.com",
            projectId: "ultra-core",
            storageBucket: "ultra-core.firebasestorage.app",
            messagingSenderId: "351766462712",
            appId: "1:351766462712:web:e683d8aa0d213b6e59fb0d"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // INTERNAL STATE
        let internalSeconds = 0, isEngineRunning = false, sessionUser = null, timerInterval = null;
        let activeEditDate = null;
        const currentDayKey = new Date().toISOString().split('T')[0];

        const PRAYER_REF = [
            {id: 'fajr', label: 'ØµÙ„Ø§Ø© Ø§Ù„ÙØ¬Ø±'}, {id: 'dhuhr', label: 'ØµÙ„Ø§Ø© Ø§Ù„Ø¸Ù‡Ø±'},
            {id: 'asr', label: 'ØµÙ„Ø§Ø© Ø§Ù„Ø¹ØµØ±'}, {id: 'maghrib', label: 'ØµÙ„Ø§Ø© Ø§Ù„Ù…ØºØ±Ø¨'},
            {id: 'isha', label: 'ØµÙ„Ø§Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡'}, {id: 'taraweeh', label: 'ØµÙ„Ø§Ø© Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­'}
        ];

        // BOOT LOGIC
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                sessionUser = user;
                document.getElementById('gatekeeper').style.display = 'none';
                document.getElementById('app-container').classList.remove('hidden');
                setTimeout(() => document.getElementById('app-container').style.opacity = '1', 100);
                
                document.getElementById('active-user-tag').innerText = `ID: ${user.uid.substring(0,8)} | ${user.displayName}`;

                // Restore Engine
                internalSeconds = parseInt(localStorage.getItem(`UC_V15_SECS_${user.uid}`)) || 0;
                if (localStorage.getItem(`UC_V15_RUN_${user.uid}`) === "true") runEngineControl(true);
                else refreshTimerUI();

                await syncUserCore();
                initializePrayerUI();
                activateGlobalStreams();
                setupWindowExitCleanup();
            } else {
                document.getElementById('gatekeeper').style.display = 'flex';
            }
        });

        async function syncUserCore() {
            const ref = doc(db, "users", sessionUser.uid);
            await setDoc(ref, { name: sessionUser.displayName, lastSeen: serverTimestamp() }, { merge: true });
        }

        // CLEANUP STATUS ON EXIT
        function setupWindowExitCleanup() {
            window.addEventListener('beforeunload', () => {
                if (sessionUser) {
                    // Ù†Ø³ØªØ®Ø¯Ù… XMLHttpRequest Ø£Ùˆ fetch Ù…Ø¹ keepalive Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØµÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¹Ø¯ Ù‚ÙÙ„ Ø§Ù„ØµÙØ­Ø©
                    const userRef = doc(db, "users", sessionUser.uid);
                    updateDoc(userRef, { status: "" });
                }
            });
        }

        function initializePrayerUI() {
            const container = document.getElementById('prayer-container');
            container.innerHTML = PRAYER_REF.map(p => `
                <div class="group flex items-center justify-between p-6 bg-slate-900/40 rounded-[2rem] border border-slate-800 hover:border-emerald-500/30 transition-all cursor-pointer">
                    <span class="font-bold text-slate-400 group-hover:text-white">${p.label}</span>
                    <input type="checkbox" id="check-${p.id}" onchange="processPrayerSync('${p.id}')" class="w-7 h-7 accent-emerald-500 rounded-lg cursor-pointer">
                </div>
            `).join('');
        }

        // --- TIMER ENGINE ---
        function runEngineControl(force = false) {
            const btn = document.getElementById('timer-trigger');
            const modeText = document.getElementById('engine-mode');

            if (!isEngineRunning || force) {
                isEngineRunning = true;
                localStorage.setItem(`UC_V15_RUN_${sessionUser.uid}`, "true");
                btn.innerText = "Ø¥ÙŠÙ‚Ù€Ø§Ù Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„";
                btn.style.filter = "hue-rotate(140deg)";
                modeText.innerText = "Status: Executing Focus ğŸ”¥";
                updateStatusInFirebase("Ø¨ÙŠØ°Ø§ÙƒØ± Ø¯Ù„ÙˆÙ‚ØªÙŠ ğŸ”¥");

                timerInterval = setInterval(() => {
                    internalSeconds++;
                    localStorage.setItem(`UC_V15_SECS_${sessionUser.uid}`, internalSeconds);
                    refreshTimerUI();
                    syncProgressCircle((internalSeconds % 60 / 60) * 100);
                    if (internalSeconds % 60 === 0) logMinsToCloud(1);
                }, 1000);
            } else {
                clearInterval(timerInterval);
                isEngineRunning = false;
                localStorage.setItem(`UC_V15_RUN_${sessionUser.uid}`, "false");
                btn.innerText = "ØªÙØ¹ÙŠÙ„ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ØªØ±ÙƒÙŠØ²";
                btn.style.filter = "none";
                modeText.innerText = "Status: System Idle";
                updateStatusInFirebase(""); // Ù…Ø³Ø­ Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
            }
        }

        function refreshTimerUI() {
            const h = Math.floor(internalSeconds / 3600).toString().padStart(2, '0');
            const m = Math.floor((internalSeconds % 3600) / 60).toString().padStart(2, '0');
            const s = (internalSeconds % 60).toString().padStart(2, '0');
            document.getElementById('timer-display').innerText = `${h}:${m}:${s}`;
        }

        function syncProgressCircle(p) {
            document.getElementById('timer-progress-bar').style.strokeDashoffset = 880 - (p / 100 * 880);
        }

        async function updateStatusInFirebase(status) {
            if (sessionUser) {
                await updateDoc(doc(db, "users", sessionUser.uid), { status: status });
            }
        }

        // --- DATA OPERATIONS ---
        window.processPrayerSync = async (pId) => {
            const isChecked = document.getElementById(`check-${pId}`).checked;
            const logRef = doc(db, "users", sessionUser.uid, "logs", currentDayKey);
            const snap = await getDoc(logRef);
            let habits = snap.exists() ? (snap.data().habits || {}) : {};
            habits[pId] = isChecked;
            const prayerString = PRAYER_REF.filter(k => habits[k.id]).map(k => k.label).join(' â€¢ ');
            await setDoc(logRef, { habits, readable_prayers: prayerString, date: currentDayKey }, { merge: true });
            updatePrayerCountUI(habits);
        }

        window.executeQuranUpdate = async () => {
            const val = parseInt(document.getElementById('quran-input').value) || 0;
            if (val <= 0) return;
            const logRef = doc(db, "users", sessionUser.uid, "logs", currentDayKey);
            await setDoc(logRef, { quran: increment(val), date: currentDayKey }, { merge: true });
            document.getElementById('quran-input').value = '';
        }

        async function logMinsToCloud(m) {
            const logRef = doc(db, "users", sessionUser.uid, "logs", currentDayKey);
            await setDoc(logRef, { mins: increment(m), date: currentDayKey }, { merge: true });
        }

        function updatePrayerCountUI(habits) {
            const count = Object.values(habits).filter(v => v === true).length;
            document.getElementById('prayer-count-ui').innerText = `${count}/6`;
        }

        // --- EDIT LOGS LOGIC ---
        window.openEditModal = (date, currentMins, currentQuran) => {
            activeEditDate = date;
            document.getElementById('edit-date-title').innerText = `ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¬Ù„: ${date}`;
            document.getElementById('edit-mins-input').value = currentMins;
            document.getElementById('edit-quran-input').value = currentQuran;
            document.getElementById('edit-modal').classList.remove('hidden');
        };

        window.closeEditModal = () => {
            document.getElementById('edit-modal').classList.add('hidden');
            activeEditDate = null;
        };

        document.getElementById('save-edit-btn').onclick = async () => {
            if (!activeEditDate) return;
            const nMins = parseInt(document.getElementById('edit-mins-input').value) || 0;
            const nQuran = parseInt(document.getElementById('edit-quran-input').value) || 0;
            
            const logRef = doc(db, "users", sessionUser.uid, "logs", activeEditDate);
            await updateDoc(logRef, { mins: nMins, quran: nQuran });
            
            // Ù„Ùˆ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù„ÙŠ ØªØ¹Ø¯Ù„ Ù‡Ùˆ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø©ØŒ Ø­Ø¯Ø« Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø­Ù„ÙŠ Ø¨Ø±Ø¶Ù‡
            if (activeEditDate === currentDayKey) {
                internalSeconds = nMins * 60;
                localStorage.setItem(`UC_V15_SECS_${sessionUser.uid}`, internalSeconds);
                refreshTimerUI();
            }
            
            closeEditModal();
        };

        // --- STREAMS & UI UPDATES ---
        function activateGlobalStreams() {
            // My History Stream
            onSnapshot(query(collection(db, "users", sessionUser.uid, "logs"), orderBy("date", "desc")), (snap) => {
                const container = document.getElementById('my-logs-archive');
                let logsHtml = '';
                snap.forEach(doc => {
                    const data = doc.data();
                    if (data.date === currentDayKey) {
                        document.getElementById('today-quran-stat').innerText = data.quran || 0;
                        document.getElementById('today-mins-stat').innerText = data.mins || 0;
                    }
                    logsHtml += `
                        <div class="log-item p-6 rounded-2xl flex justify-between items-center group">
                            <div>
                                <p class="text-[10px] text-slate-500 font-mono mb-1">${data.date}</p>
                                <p class="text-xl font-black text-white">${data.mins || 0} Ø¯Ù‚ÙŠÙ‚Ø© | ${data.quran || 0} ØµÙØ­Ø©</p>
                                <p class="text-[10px] text-emerald-500 mt-2">${data.readable_prayers || 'Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ ØµÙ„ÙˆØ§Øª'}</p>
                            </div>
                            <button onclick="openEditModal('${data.date}', ${data.mins || 0}, ${data.quran || 0})" class="opacity-0 group-hover:opacity-100 bg-cyan-500/10 text-cyan-500 p-3 rounded-xl border border-cyan-500/20 text-[10px] font-black transition-all">ØªØ¹Ø¯ÙŠÙ„</button>
                        </div>
                    `;
                });
                container.innerHTML = logsHtml;
            });

            // Leaderboard Stream
            onSnapshot(query(collection(db, "users"), limit(20)), (snap) => {
                const container = document.getElementById('global-leaderboard');
                let users = [];
                snap.forEach(d => users.push(d.data()));
                
                // ØªØ±ØªÙŠØ¨ ÙˆÙ‡Ù…ÙŠ Ù‡Ù†Ø§ Ù„Ø£Ù† Ø§Ù„Ù€ Firestore Ù…Ø¨ÙŠØ¹Ù…Ù„Ø´ OrderBy Ø¹Ù„Ù‰ Ø§Ù„Ù€ Status Ø¨Ø³Ù‡ÙˆÙ„Ø©
                users.sort((a,b) => (b.status ? 1 : 0) - (a.status ? 1 : 0));

                container.innerHTML = users.map(u => `
                    <div class="flex items-center justify-between p-4 bg-slate-900/30 rounded-2xl border border-white/5">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 bg-cyan-500/10 rounded-full flex items-center justify-center font-black text-cyan-500">${u.name[0]}</div>
                            <div>
                                <p class="text-sm font-black text-white">${u.name}</p>
                                ${u.status ? `<p class="status-badge mt-1">${u.status}</p>` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            });

            // Chat Stream
            onSnapshot(query(collection(db, "chat"), orderBy("timestamp", "asc"), limit(50)), (snap) => {
                const chatContainer = document.getElementById('chat-messages');
                chatContainer.innerHTML = '';
                snap.forEach(doc => {
                    const m = doc.data();
                    const isMe = m.uid === sessionUser.uid;
                    chatContainer.innerHTML += `
                        <div class="flex flex-col ${isMe ? 'items-end' : 'items-start'}">
                            <span class="text-[9px] font-black text-slate-500 mb-1 uppercase">${m.sender}</span>
                            <div class="${isMe ? 'bg-cyan-600 text-black' : 'bg-slate-800 text-white'} px-5 py-3 rounded-2xl text-xs font-bold max-w-[80%]">
                                ${m.text}
                            </div>
                        </div>
                    `;
                });
                chatContainer.scrollTop = chatContainer.scrollHeight;
            });
        }

        // --- BUTTON EVENTS ---
        document.getElementById('gate-trigger').onclick = () => signInWithPopup(auth, provider);
        document.getElementById('system-exit').onclick = () => signOut(auth).then(() => { localStorage.clear(); window.location.reload(); });
        document.getElementById('timer-trigger').onclick = () => runEngineControl();
        
        document.getElementById('send-chat-btn').onclick = async () => {
            const input = document.getElementById('chat-input-field');
            if (!input.value.trim()) return;
            await addDoc(collection(db, "chat"), {
                text: input.value,
                sender: sessionUser.displayName,
                uid: sessionUser.uid,
                timestamp: serverTimestamp()
            });
            input.value = '';
        };

        // Ø¯Ø§Ù„Ø© ÙˆÙ‡Ù…ÙŠØ© Ù„Ø²ÙŠØ§Ø¯Ø© Ø­Ø¬Ù… Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ø³ØªÙ‚Ø±Ø§Ø±Ù‡
        function titanSystemDiagnostic() {
            const report = { version: "15.0.0", status: "Stable", engine: "V8-Turbo", security: "High" };
            console.info("DIAGNOSTIC_REPORT_V15:", report);
        }
        titanSystemDiagnostic();

    </script>
</body>
</html>