<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ğŸ”¥ Study War Ultimate</title>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>

<style>
body{
    font-family: "Arial", sans-serif;
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:white;
    text-align:center;
    padding:20px;
    transition: all 0.5s;
}
h1{
    font-size: 3em;
    margin-bottom: 20px;
    color: #00ffcc;
    text-shadow: 0 0 20px #00ffcc;
}
input, button{
    padding:10px 15px;
    margin:5px;
    border-radius:8px;
    border:none;
    font-size:16px;
    outline:none;
    transition: 0.3s;
}
input:focus{
    box-shadow:0 0 10px #00ffcc;
}
button{
    cursor:pointer;
    font-weight:bold;
    background:#ff00ff;
    color:white;
    box-shadow:0 0 10px #ff00ff;
}
button:hover{
    transform: scale(1.05);
}
#leaderboard{
    margin-top:20px;
}
.player{
    background: rgba(255,255,255,0.05);
    margin:10px auto;
    padding:10px;
    border-radius:10px;
    width: 300px;
    transition: transform 0.3s, background 0.3s;
}
.player:hover{
    transform: scale(1.05);
    background: rgba(255,255,255,0.2);
}
.first{
    background: gold;
    color:black;
    font-weight:bold;
    text-shadow:0 0 10px black;
}
.badge{
    display:inline-block;
    background:#ffcc00;
    color:black;
    padding:5px 10px;
    border-radius:5px;
    margin-left:5px;
    font-weight:bold;
    animation: badgePop 0.5s;
}
@keyframes badgePop{
    0%{transform: scale(0);}
    100%{transform: scale(1);}
}
</style>
</head>
<body>

<h1>ğŸ”¥ Study War Ultimate</h1>

<div id="auth">
    <button id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Google</button>
</div>

<div id="main" style="display:none;">
    <h2 id="welcome"></h2>
    <input type="number" id="hours" placeholder="Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©">
    <button onclick="addStudy()">Ø£Ø¶Ù Ø³Ø§Ø¹Ø§Øª</button>
    <div id="achievements"></div>

    <h2>ğŸ† Leaderboard</h2>
    <div id="leaderboard"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, addDoc, doc, getDocs, query, orderBy, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyASLT_wouo9BTjd-dH18x8CLbqBZSMbz04",
  authDomain: "ultra-core.firebaseapp.com",
  projectId: "ultra-core",
  storageBucket: "ultra-core.firebasestorage.app",
  messagingSenderId: "351766462712",
  appId: "1:351766462712:web:e683d8aa0d213b6e59fb0d"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore(app);
const playersRef = collection(db,"players");
const provider = new GoogleAuthProvider();

const loginBtn = document.getElementById("loginBtn");
loginBtn.addEventListener("click", ()=>{
    signInWithPopup(auth,provider).then(result=>{
        console.log("Logged in:",result.user.displayName);
    }).catch(console.error);
});

onAuthStateChanged(auth,user=>{
    if(user){
        document.getElementById("auth").style.display="none";
        document.getElementById("main").style.display="block";
        document.getElementById("welcome").innerText = `Ù…Ø±Ø­Ø¨Ù‹Ø§ ${user.displayName}`;
        checkUser(user);
        listenLeaderboard();
    }else{
        document.getElementById("auth").style.display="block";
        document.getElementById("main").style.display="none";
    }
});

// Check if user exists in Firestore
async function checkUser(user){
    const snapshot = await getDocs(playersRef);
    let exists = false;
    snapshot.forEach(docItem=>{
        if(docItem.data().uid === user.uid){
            exists = true;
        }
    });
    if(!exists){
        await addDoc(playersRef,{
            uid:user.uid,
            name:user.displayName,
            points:0,
            totalHours:0,
            badges:[]
        });
    }
}

// Add study hours
window.addStudy = async function(){
    const hours = parseInt(document.getElementById("hours").value);
    if(!hours) return alert("Ø§Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª ØµØ­ÙŠØ­");

    const user = auth.currentUser;
    const snapshot = await getDocs(playersRef);
    snapshot.forEach(async docItem=>{
        if(docItem.data().uid === user.uid){
            let points = docItem.data().points + hours*10;
            let totalHours = docItem.data().totalHours + hours;
            let badges = docItem.data().badges || [];

            // Assign new badge for milestones
            if(totalHours >= 10 && !badges.includes("10 Ø³Ø§Ø¹Ø§Øª")){
                badges.push("10 Ø³Ø§Ø¹Ø§Øª");
                showBadge("10 Ø³Ø§Ø¹Ø§Øª");
            }
            if(totalHours >= 50 && !badges.includes("50 Ø³Ø§Ø¹Ø§Øª")){
                badges.push("50 Ø³Ø§Ø¹Ø§Øª");
                showBadge("50 Ø³Ø§Ø¹Ø§Øª");
            }
            await updateDoc(doc(db,"players",docItem.id),{
                totalHours,
                points,
                badges
            });
        }
    });
    document.getElementById("hours").value="";
};

function showBadge(name){
    const ach = document.getElementById("achievements");
    const span = document.createElement("span");
    span.className="badge";
    span.innerText=name;
    ach.appendChild(span);
}

// Leaderboard with animation
function listenLeaderboard(){
    const q = query(playersRef, orderBy("points","desc"));
    onSnapshot(q,(snapshot)=>{
        const board = document.getElementById("leaderboard");
        board.innerHTML="";
        let index=0;
        snapshot.forEach(docItem=>{
            index++;
            let div = document.createElement("div");
            div.className="player";
            if(index===1) div.classList.add("first");
            div.innerHTML = `
                <h3>Ø§Ù„Ù…Ø±ÙƒØ² ${index}</h3>
                <p>${docItem.data().name}</p>
                <p>${docItem.data().points} Ù†Ù‚Ø·Ø©</p>
            `;
            board.appendChild(div);
        });
    });
}
</script>

</body>
</html>
