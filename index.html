<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TITAN CORE V60 | Ù†Ø¸Ø§Ù… Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=JetBrains+Mono:wght@500;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --titan-cyan: #06b6d4;
            --titan-emerald: #10b981;
            --titan-red: #ef4444;
            --titan-bg: #010409;
            --titan-panel: rgba(13, 17, 23, 0.98);
            --titan-border: rgba(48, 54, 61, 0.4);
            --titan-glow: 0 0 20px rgba(6, 182, 212, 0.15);
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--titan-bg);
            color: #e6edf3;
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(6, 182, 212, 0.02) 0%, transparent 70%),
                linear-gradient(rgba(255, 255, 255, 0.005) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.005) 1px, transparent 1px);
            background-size: 100% 100%, 25px 25px, 25px 25px;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }

        /* Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù‡ÙŠÙƒÙ„ÙŠØ© */
        .node-container {
            background: var(--titan-panel);
            backdrop-filter: blur(15px);
            border: 1px solid var(--titan-border);
            border-radius: 1.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .node-container:hover {
            border-color: var(--titan-cyan);
            box-shadow: var(--titan-glow);
        }

        /* Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… */
        .engine-orbital {
            position: relative;
            width: 320px;
            height: 320px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .orbital-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .orbital-track { fill: none; stroke: #0d1117; stroke-width: 15; }
        .orbital-fill {
            fill: none; stroke: var(--titan-cyan); stroke-width: 15; stroke-linecap: round;
            stroke-dasharray: 880; stroke-dashoffset: 880;
            transition: stroke-dashoffset 1s linear;
            filter: drop-shadow(0 0 8px var(--titan-cyan));
        }

        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… */
        .cmd-button {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: #000; font-weight: 800;
            border-radius: 1rem;
            transition: 0.3s;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .cmd-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(6, 182, 212, 0.3);
        }

        .cmd-button:active { transform: scale(0.98); }

        /* Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù„ÙˆØ¬ */
        .prayer-matrix {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .prayer-cell {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 700;
            border: 1px solid transparent;
            transition: 0.3s;
        }

        .cell-active { background: rgba(16, 185, 129, 0.1); border-color: var(--titan-emerald); color: var(--titan-emerald); }
        .cell-inactive { background: rgba(239, 68, 68, 0.1); border-color: var(--titan-red); color: var(--titan-red); }

        /* Ø§Ù„Ø±ØµØ¯ ÙˆØ§Ù„ØªØ±ØªÙŠØ¨ */
        .rank-gold { color: #fbbf24; filter: drop-shadow(0 0 5px rgba(251, 191, 36, 0.4)); }
        .rank-silver { color: #94a3b8; }
        .rank-bronze { color: #92400e; }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ */
        .custom-scroll { overflow-y: auto; scrollbar-width: thin; scrollbar-color: #30363d transparent; }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #30363d; border-radius: 10px; }

        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø­Ø§Ù„Ø© */
        .pulse-core {
            width: 6px; height: 6px; background: var(--titan-cyan); border-radius: 50%;
            animation: core-pulse 2s infinite;
        }

        @keyframes core-pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.6); opacity: 0.4; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>

    <div id="security-gate" class="fixed inset-0 z-[9999] bg-black flex flex-col items-center justify-center p-6">
        <div class="mb-12 text-center">
            <h1 class="text-8xl font-black text-white italic tracking-tighter mb-4">TITAN</h1>
            <div class="h-1 w-48 bg-cyan-600 mx-auto rounded-full"></div>
            <p class="mono text-xs text-cyan-800 tracking-[1em] mt-4">V60_CORE_INITIALIZE</p>
        </div>
        <button id="auth-trigger" class="cmd-button px-16 py-6 text-xl">
            Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ©
        </button>
    </div>

    <div id="titan-mainframe" class="hidden opacity-0 transition-all duration-1000 p-6">
        <div class="max-w-[1700px] mx-auto grid grid-cols-12 gap-6">
            
            <aside class="col-span-12 lg:col-span-3 space-y-6">
                <div class="node-container p-6 relative overflow-hidden">
                    <div class="absolute -right-4 -top-4 w-24 h-24 bg-cyan-500/5 rounded-full blur-2xl"></div>
                    <div class="flex items-center gap-4">
                        <div id="user-hex" class="w-14 h-14 bg-cyan-900/30 border border-cyan-500/30 rounded-xl flex items-center justify-center text-cyan-400 font-black text-2xl">?</div>
                        <div>
                            <h2 id="user-alias" class="text-lg font-black text-white truncate max-w-[150px]">ØªØ­Ù…ÙŠÙ„...</h2>
                            <div class="flex items-center gap-2">
                                <span class="pulse-core"></span>
                                <p id="sys-time" class="text-sm font-bold mono text-cyan-600 tracking-wider">00:00:00</p>
                            </div>
                        </div>
                    </div>
                    <button id="deauth-cmd" class="mt-6 w-full py-2 bg-red-900/10 text-red-700 text-[10px] font-black uppercase tracking-widest border border-red-900/20 rounded-lg hover:bg-red-900/20 transition-all">Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„</button>
                </div>

                <div class="node-container p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-sm font-black text-slate-400 uppercase tracking-widest italic">Ù…ØµÙÙˆÙØ© Ø§Ù„ØµÙ„ÙˆØ§Øª</h3>
                        <div id="p-ratio" class="mono text-xs font-black bg-cyan-500/10 text-cyan-500 px-2 py-1 rounded">0/6</div>
                    </div>
                    <div id="prayer-hook" class="space-y-2">
                        </div>
                </div>

                <div class="node-container p-6">
                    <h3 class="text-sm font-black text-slate-400 uppercase tracking-widest mb-4 italic">ØªØºØ°ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù‚Ø±Ø¢Ù†)</h3>
                    <div class="flex gap-2">
                        <input type="number" id="q-input" class="flex-1 bg-black border border-slate-800 rounded-lg p-3 text-white font-black text-center focus:border-cyan-500 outline-none" placeholder="0">
                        <button id="q-push" class="cmd-button px-6 text-xs uppercase">Ø¯ÙØ¹</button>
                    </div>
                </div>
            </aside>

            <section class="col-span-12 lg:col-span-6 space-y-6">
                <div class="node-container p-10 flex flex-col items-center">
                    <div class="engine-orbital">
                        <svg class="orbital-svg" viewBox="0 0 320 320">
                            <circle class="orbital-track" cx="160" cy="160" r="140"></circle>
                            <circle id="orb-progress" class="orbital-fill" cx="160" cy="160" r="140"></circle>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span class="text-[10px] text-slate-600 font-black tracking-[0.5em] mb-2 uppercase">Core_Time</span>
                            <h2 id="orb-timer" class="text-6xl font-black mono text-white leading-none">00:00:00</h2>
                            <div id="orb-status" class="mt-4 text-[9px] font-bold text-slate-500 tracking-[0.2em] uppercase">Ready_for_Operation</div>
                        </div>
                    </div>
                    
                    <button id="orb-trigger" class="cmd-button mt-10 w-full max-w-sm py-6 text-lg italic">ØªØ´ØºÙŠÙ„ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ØªØ±ÙƒÙŠØ²</button>
                    
                    <div class="grid grid-cols-2 gap-6 w-full mt-10 pt-8 border-t border-white/5">
                        <div class="text-center">
                            <p class="text-[9px] text-slate-500 font-black uppercase mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ±ÙƒÙŠØ² (Ø¯)</p>
                            <p id="dash-m" class="text-4xl font-black mono text-white">0</p>
                        </div>
                        <div class="text-center">
                            <p class="text-[9px] text-slate-500 font-black uppercase mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ„Ø§ÙˆØ© (Øµ)</p>
                            <p id="dash-q" class="text-4xl font-black mono text-white">0</p>
                        </div>
                    </div>
                </div>

                <div class="node-container p-6">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-1 h-6 bg-cyan-500"></div>
                        <h3 class="text-sm font-black uppercase tracking-widest italic">Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</h3>
                    </div>
                    <div id="history-stream" class="space-y-4 max-h-[700px] custom-scroll pr-2">
                        </div>
                </div>
            </section>

            <aside class="col-span-12 lg:col-span-3 space-y-6">
                <div class="node-container p-6 border-b-2 border-cyan-500">
                    <h3 class="text-xs font-black text-center mb-6 uppercase tracking-[0.2em] text-cyan-500">Global_Monitoring_System</h3>
                    <div id="leaderboard-hook" class="space-y-3 max-h-[450px] custom-scroll pr-1">
                        </div>
                </div>

                <div class="node-container h-[500px] flex flex-col overflow-hidden">
                    <div class="p-4 bg-black/40 border-b border-white/5 flex justify-between items-center">
                        <span class="text-[10px] font-black text-cyan-600 tracking-widest uppercase">Comm_Link_Active</span>
                        <div class="w-2 h-2 bg-cyan-500 rounded-full animate-pulse"></div>
                    </div>
                    <div id="comms-flow" class="flex-1 overflow-y-auto p-4 space-y-4 custom-scroll text-sm">
                        </div>
                    <div class="p-3 bg-black/60 flex gap-2 backdrop-blur-md">
                        <input id="comms-input" type="text" placeholder="Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø§Ø±Ø©..." class="flex-1 bg-slate-900 border border-slate-800 rounded-lg px-4 py-2 text-white text-xs outline-none focus:border-cyan-600 transition-all">
                        <button id="comms-send" class="bg-cyan-600 text-black px-4 rounded-lg font-black">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                        </button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <div id="inspector-modal" class="hidden fixed inset-0 z-[10000] bg-black/95 flex items-center justify-center p-6 backdrop-blur-2xl">
        <div class="node-container w-full max-w-4xl p-10 relative">
            <button onclick="CoreUI.closeInspector()" class="absolute top-6 left-6 text-3xl text-slate-500 hover:text-white">&times;</button>
            <div class="mb-10">
                <h4 id="ins-alias" class="text-4xl font-black italic mb-2 tracking-tighter"></h4>
                <div class="h-0.5 w-32 bg-cyan-600"></div>
            </div>
            <div id="ins-data" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[500px] custom-scroll"></div>
        </div>
    </div>

    <div id="editor-modal" class="hidden fixed inset-0 z-[11000] bg-black/98 flex items-center justify-center p-6 backdrop-blur-3xl">
        <div class="node-container w-full max-w-xl p-8 border-2 border-cyan-500/20">
            <h4 class="text-xl font-black mb-8 italic border-r-4 border-cyan-500 pr-4">Ø¥Ø¹Ø§Ø¯Ø© ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
            <div class="space-y-8">
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-[10px] text-slate-500 font-black uppercase">Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚</label>
                        <input type="number" id="ed-m" class="w-full bg-black border border-slate-800 rounded-xl p-4 text-white font-black text-2xl outline-none focus:border-cyan-500">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] text-slate-500 font-black uppercase">Ø§Ù„ØµÙØ­Ø§Øª</label>
                        <input type="number" id="ed-q" class="w-full bg-black border border-slate-800 rounded-xl p-4 text-white font-black text-2xl outline-none focus:border-cyan-500">
                    </div>
                </div>
                <div id="ed-prayer-matrix" class="grid grid-cols-3 gap-2 bg-white/5 p-4 rounded-xl border border-white/5">
                    </div>
                <div class="flex gap-4">
                    <button id="ed-save" class="flex-1 cmd-button py-4 text-sm uppercase">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                    <button onclick="CoreUI.closeEditor()" class="flex-1 bg-slate-800 text-white rounded-xl font-black text-xs uppercase">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, query, collection, orderBy, limit, updateDoc, increment, addDoc, serverTimestamp, getDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // FIREBASE MASTER CONFIGURATION
        const fbConfig = {
            apiKey: "AIzaSyASLT_wouo9BTjd-dH18x8CLbqBZSMbz04",
            authDomain: "ultra-core.firebaseapp.com",
            projectId: "ultra-core",
            storageBucket: "ultra-core.firebasestorage.app",
            messagingSenderId: "351766462712",
            appId: "1:351766462712:web:e683d8aa0d213b6e59fb0d"
        };

        const app = initializeApp(fbConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        /**
         * TITAN V60 KERNEL - ARCHITECTURAL CLASS
         * ÙŠØªÙ… ØªÙ†Ø¸ÙŠÙ… Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ ÙˆØ­Ø¯Ø§Øª Ø¨Ø±Ù…Ø¬ÙŠØ© Ù…Ø¹Ù‚Ø¯Ø© Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…ØªØ§Ù†Ø© ÙˆØ§Ù„ØªØ¹Ù‚ÙŠØ¯
         */
        class TitanCore {
            constructor() {
                this.user = null;
                this.secs = 0;
                this.isActive = false;
                this.ticker = null;
                this.today = new Date().toISOString().split('T')[0];
                this.activeEdit = { date: null, habits: {} };
                this.prayerSchema = [
                    {id:'fajr', n:'Ø§Ù„ÙØ¬Ø±'}, {id:'dhuhr', n:'Ø§Ù„Ø¸Ù‡Ø±'}, {id:'asr', n:'Ø§Ù„Ø¹ØµØ±'},
                    {id:'maghrib', n:'Ø§Ù„Ù…ØºØ±Ø¨'}, {id:'isha', n:'Ø§Ù„Ø¹Ø´Ø§Ø¡'}, {id:'taraweeh', n:'ØªØ±Ø§ÙˆÙŠØ­'}
                ];
            }

            async initialize(userData) {
                this.user = userData;
                CoreUI.boot(true);
                this.restoreSession();
                await this.syncProfile();
                this.startLiveStreams();
            }

            async syncProfile() {
                const ref = doc(db, "users", this.user.uid);
                await setDoc(ref, { 
                    name: this.user.displayName, 
                    uid: this.user.uid, 
                    lastActive: serverTimestamp() 
                }, { merge: true });
                document.getElementById('user-alias').innerText = this.user.displayName;
                document.getElementById('user-hex').innerText = this.user.displayName[0];
            }

            restoreSession() {
                const s = localStorage.getItem(`v60_secs_${this.user.uid}`);
                this.secs = s ? parseInt(s) : 0;
                if(localStorage.getItem(`v60_run_${this.user.uid}`) === "true") this.toggleEngine();
                else CoreUI.updateOrbDisplay();
            }

            toggleEngine() {
                if(!this.isActive) {
                    this.isActive = true;
                    localStorage.setItem(`v60_run_${this.user.uid}`, "true");
                    CoreUI.setOrbState(true);
                    this.broadcastStatus("Ø¨ÙŠØ°Ø§ÙƒØ± Ø¯Ù„ÙˆÙ‚ØªÙŠ ğŸ”¥");
                    this.ticker = setInterval(() => {
                        this.secs++;
                        localStorage.setItem(`v60_secs_${this.user.uid}`, this.secs);
                        CoreUI.updateOrbDisplay();
                        if(this.secs % 60 === 0) this.incrementLog('mins', 1);
                    }, 1000);
                } else {
                    clearInterval(this.ticker);
                    this.isActive = false;
                    localStorage.setItem(`v60_run_${this.user.uid}`, "false");
                    CoreUI.setOrbState(false);
                    this.broadcastStatus("");
                }
            }

            async incrementLog(field, val) {
                const ref = doc(db, "users", this.user.uid, "logs", this.today);
                await setDoc(ref, { [field]: increment(val), date: this.today }, { merge: true });
            }

            async broadcastStatus(msg) {
                if(!this.user) return;
                await updateDoc(doc(db, "users", this.user.uid), { 
                    status: msg, 
                    currentFocus: this.todayFocus || 0 
                });
            }

            startLiveStreams() {
                // ØªÙŠØ§Ø± Ø§Ù„Ø±ØµØ¯ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ
                onSnapshot(query(collection(db, "users"), limit(40)), (snap) => {
                    const users = snap.docs.map(d => ({...d.data(), score: d.data().currentFocus || 0}))
                                        .sort((a,b) => b.score - a.score);
                    CoreUI.renderLeaderboard(users);
                });

                // ØªÙŠØ§Ø± Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø´Ø®ØµÙŠ
                onSnapshot(query(collection(db, "users", this.user.uid, "logs"), orderBy("date", "desc")), (snap) => {
                    this.todayFocus = 0;
                    const logs = snap.docs.map(doc => {
                        const d = doc.data();
                        if(d.date === this.today) {
                            this.todayFocus = d.mins || 0;
                            CoreUI.updateDashboard(d);
                        }
                        return d;
                    });
                    CoreUI.renderHistory(logs);
                });

                // ØªÙŠØ§Ø± Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª
                onSnapshot(query(collection(db, "chat"), orderBy("timestamp", "asc"), limit(60)), (snap) => {
                    CoreUI.renderComms(snap.docs.map(d => d.data()));
                });

                // ØªÙŠØ§Ø± Ø­Ø§Ù„Ø© Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
                onSnapshot(doc(db, "users", this.user.uid, "logs", this.today), (snap) => {
                    if(snap.exists()) CoreUI.syncPrayerUI(snap.data().habits || {});
                });
            }
        }

        /**
         * INTERFACE ENGINE - UI CLASS
         * ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ÙƒÙ„ Ù…Ø§ ÙŠØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø¬Ù…Ø§Ù„ÙŠØ§Øª
         */
        const CoreUI = {
            boot(isReady) {
                document.getElementById('security-gate').style.display = isReady ? 'none' : 'flex';
                const frame = document.getElementById('titan-mainframe');
                frame.classList.toggle('hidden', !isReady);
                if(isReady) {
                    setTimeout(() => frame.style.opacity = '1', 50);
                    this.buildPrayerHooks();
                }
            },

            updateOrbDisplay() {
                const s = Kernel.secs;
                const h = Math.floor(s/3600).toString().padStart(2,'0');
                const m = Math.floor((s%3600)/60).toString().padStart(2,'0');
                const sc = (s%60).toString().padStart(2,'0');
                document.getElementById('orb-timer').innerText = `${h}:${m}:${sc}`;
                document.getElementById('orb-progress').style.strokeDashoffset = 880 - ((s%60)/60 * 880);
            },

            setOrbState(active) {
                const btn = document.getElementById('orb-trigger');
                const status = document.getElementById('orb-status');
                btn.innerText = active ? "Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù€Ø¹Ù…Ù„ÙŠØ©" : "ØªØ´ØºÙŠÙ„ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ØªØ±ÙƒÙŠØ²";
                btn.style.filter = active ? "hue-rotate(150deg) brightness(1.1)" : "none";
                status.innerText = active ? "Ø¬Ø§Ø±ÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‡Ù…Ø© ğŸ”¥" : "Ready_for_Operation";
            },

            buildPrayerHooks() {
                const h = document.getElementById('prayer-hook');
                h.innerHTML = Kernel.prayerSchema.map(p => `
                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/5 hover:border-cyan-500/20 transition-all">
                        <span class="text-xs font-bold text-slate-400">${p.n}</span>
                        <input type="checkbox" id="chk-${p.id}" onchange="KernelUIHandlers.togglePrayer('${p.id}')" class="w-5 h-5 accent-cyan-500 cursor-pointer">
                    </div>
                `).join('');
            },

            updateDashboard(d) {
                document.getElementById('dash-m').innerText = d.mins || 0;
                document.getElementById('dash-q').innerText = d.quran || 0;
                const done = Object.values(d.habits || {}).filter(v => v).length;
                document.getElementById('p-ratio').innerText = `${done}/6`;
            },

            renderLeaderboard(users) {
                const hook = document.getElementById('leaderboard-hook');
                hook.innerHTML = users.map((u, i) => `
                    <div onclick="CoreUI.openInspector('${u.uid}', '${u.name}')" class="flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/5 cursor-pointer hover:bg-white/10 transition-all">
                        <div class="flex items-center gap-3">
                            <span class="mono text-xs font-black ${i==0?'rank-gold':i==1?'rank-silver':i==2?'rank-bronze':'text-slate-700'}">#${i+1}</span>
                            <div>
                                <p class="text-xs font-black text-white">${u.name}</p>
                                ${u.status ? `<p class="text-[9px] text-cyan-500 italic mono mt-1">${u.status}</p>` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            renderHistory(logs) {
                const stream = document.getElementById('history-stream');
                stream.innerHTML = logs.map(l => {
                    const badges = Kernel.prayerSchema.map(p => `
                        <div class="prayer-cell ${(l.habits && l.habits[p.id]) ? 'cell-active' : 'cell-inactive'}">${p.n}</div>
                    `).join('');
                    return `
                        <div class="node-container p-5 relative group bg-white/[0.02]">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <p class="text-[9px] text-cyan-500 mono mb-1">${l.date}</p>
                                    <h4 class="text-2xl font-black text-white">${l.mins || 0} <span class="text-[10px] text-slate-600">Ø¯Ù‚ÙŠÙ‚Ø©</span></h4>
                                </div>
                                <div class="text-left bg-emerald-500/5 px-3 py-2 rounded-lg border border-emerald-500/10">
                                    <p class="text-xl font-black text-emerald-400">${l.quran || 0} <span class="text-[9px]">Øµ</span></p>
                                </div>
                            </div>
                            <div class="prayer-matrix">${badges}</div>
                            <button onclick="CoreUI.openEditor('${l.date}', ${l.mins || 0}, ${l.quran || 0}, ${JSON.stringify(l.habits || {}).replace(/"/g, '&quot;')})" class="absolute bottom-4 left-4 opacity-0 group-hover:opacity-100 bg-white text-black px-4 py-2 rounded-lg font-black text-[9px] transition-all">Ø¥Ø¯Ø§Ø±Ø©</button>
                        </div>
                    `;
                }).join('');
            },

            renderComms(msgs) {
                const flow = document.getElementById('comms-flow');
                flow.innerHTML = msgs.map(m => {
                    const isMe = m.uid === Kernel.user.uid;
                    return `
                        <div class="flex flex-col ${isMe?'items-end':'items-start'}">
                            <span class="text-[8px] font-black text-slate-600 mb-1 uppercase">${m.sender}</span>
                            <div class="${isMe?'bg-cyan-600 text-black':'bg-slate-800 text-white'} px-4 py-2 rounded-xl font-bold max-w-[90%]">${m.text}</div>
                        </div>
                    `;
                }).join('');
                flow.scrollTop = flow.scrollHeight;
            },

            syncPrayerUI(habits) {
                Kernel.prayerSchema.forEach(p => {
                    const el = document.getElementById(`chk-${p.id}`);
                    if(el) el.checked = habits[p.id] || false;
                });
            },

            openInspector(uid, name) {
                document.getElementById('ins-alias').innerText = name;
                const dataBox = document.getElementById('ins-data');
                dataBox.innerHTML = '<div class="col-span-full py-20 text-center mono text-cyan-600 animate-pulse">RECOVERING_DATA_PACKETS...</div>';
                document.getElementById('inspector-modal').classList.remove('hidden');
                getDocs(query(collection(db, "users", uid, "logs"), orderBy("date", "desc"))).then(snap => {
                    dataBox.innerHTML = snap.docs.map(doc => {
                        const d = doc.data();
                        const pCells = Kernel.prayerSchema.map(p => `
                            <div class="prayer-cell ${(d.habits && d.habits[p.id]) ? 'cell-active' : 'cell-inactive'}">${p.n}</div>
                        `).join('');
                        return `
                            <div class="p-4 bg-white/5 rounded-xl border border-white/5">
                                <p class="text-[9px] text-cyan-500 mono mb-3">${d.date}</p>
                                <div class="flex justify-between items-center mb-3">
                                    <p class="text-xl font-black text-white">${d.mins || 0}m</p>
                                    <p class="text-lg font-black text-emerald-400">${d.quran || 0}p</p>
                                </div>
                                <div class="prayer-matrix">${pCells}</div>
                            </div>
                        `;
                    }).join('');
                });
            },
            closeInspector() { document.getElementById('inspector-modal').classList.add('hidden'); },

            openEditor(date, mins, quran, habits) {
                Kernel.activeEdit = { date, habits: habits || {} };
                document.getElementById('ed-m').value = mins;
                document.getElementById('ed-q').value = quran;
                const matrix = document.getElementById('ed-prayer-matrix');
                matrix.innerHTML = Kernel.prayerSchema.map(p => `
                    <div class="flex flex-col items-center gap-2 p-2 bg-black/40 rounded-lg">
                        <span class="text-[8px] font-bold text-slate-500">${p.n}</span>
                        <input type="checkbox" id="ed-chk-${p.id}" ${Kernel.activeEdit.habits[p.id] ? 'checked' : ''} onchange="Kernel.activeEdit.habits['${p.id}'] = this.checked" class="w-4 h-4 accent-emerald-500">
                    </div>
                `).join('');
                document.getElementById('editor-modal').classList.remove('hidden');
            },
            closeEditor() { document.getElementById('editor-modal').classList.add('hidden'); }
        };

        /**
         * LOGIC HANDLERS
         * Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ©
         */
        const KernelUIHandlers = {
            async togglePrayer(id) {
                const isChecked = document.getElementById(`chk-${id}`).checked;
                const ref = doc(db, "users", Kernel.user.uid, "logs", Kernel.today);
                const snap = await getDoc(ref);
                let habits = snap.exists() ? (snap.data().habits || {}) : {};
                habits[id] = isChecked;
                await setDoc(ref, { habits, date: Kernel.today }, { merge: true });
            },

            async commitEdit() {
                const nM = parseInt(document.getElementById('ed-m').value) || 0;
                const nQ = parseInt(document.getElementById('ed-q').value) || 0;
                const h = Kernel.activeEdit.habits;
                const ref = doc(db, "users", Kernel.user.uid, "logs", Kernel.activeEdit.date);
                await updateDoc(ref, { mins: nM, quran: nQ, habits: h });
                
                if(Kernel.activeEdit.date === Kernel.today) {
                    Kernel.secs = nM * 60;
                    localStorage.setItem(`v60_secs_${Kernel.user.uid}`, Kernel.secs);
                    CoreUI.updateOrbDisplay();
                }
                CoreUI.closeEditor();
            }
        };

        // Ø¥Ù‚Ù„Ø§Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù…
        const Kernel = new TitanCore();
        window.Kernel = Kernel;
        window.CoreUI = CoreUI;
        window.KernelUIHandlers = KernelUIHandlers;

        onAuthStateChanged(auth, async (u) => {
            if(u) await Kernel.initialize(u);
            else CoreUI.boot(false);
        });

        // Ø§Ù„Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
        document.getElementById('auth-trigger').onclick = () => signInWithPopup(auth, provider);
        document.getElementById('deauth-cmd').onclick = () => signOut(auth).then(() => { localStorage.clear(); window.location.reload(); });
        document.getElementById('orb-trigger').onclick = () => Kernel.toggleEngine();
        document.getElementById('ed-save').onclick = () => KernelUIHandlers.commitEdit();

        document.getElementById('q-push').onclick = async () => {
            const val = parseInt(document.getElementById('q-input').value) || 0;
            if(val > 0) {
                await Kernel.incrementLog('quran', val);
                document.getElementById('q-input').value = '';
            }
        };

        document.getElementById('comms-send').onclick = async () => {
            const inp = document.getElementById('comms-input');
            if(!inp.value.trim()) return;
            await addDoc(collection(db, "chat"), {
                text: inp.value,
                sender: Kernel.user.displayName,
                uid: Kernel.user.uid,
                timestamp: serverTimestamp()
            });
            inp.value = '';
        };

        // Ø³Ø§Ø¹Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        setInterval(() => {
            document.getElementById('sys-time').innerText = new Date().toLocaleTimeString('en-US', { hour12: false });
        }, 1000);

    </script>
</body>
</html>